<?php

use App\Prodi;
use App\JurnalPenerimaan;
use App\KodeRekening;

$no = 1;

$total_saldo = 0;

$saldo_smt = array();

$mhs = JurnalPenerimaan::where('nim_mhs',$nim)->first();

?>

	<table>
		<tr>
			<td>Nama</td>
			<td>: {{ $mhs->nama_mhs }}</td>
		</tr>
		<tr>
			<td>NIM</td>
			<td>: {{ $nim }}</td>
		</tr>
		<tr>
			<td>Prodi</td>
			<td>: {{ $mhs->dataProdi->nama_prodi }}</td>
		</tr>
	</table>


	<table class="table">
		<thead>
			<tr>
				<th rowspan="2" style="width:20px;text-align:center">NO</th>
				<th rowspan="2" style="text-align:center">JENIS PEMBAYARAN</th>
				@for($i = 1; $i <= 8; $i++)
				<th>SEMESTER {{ $i }}</th>
				@endfor
				<th rowspan="2">TOTAL</th>
			</tr>
		</thead>
		<tbody>
		
		@foreach($data as $r)
			<?php
			$nama_rek = KodeRekening::find($r->kode_rekening);
			$total_setoran_row = 0;
			?>
			<tr>
				<td>{{ $no }}</td>
				<td>{{ $nama_rek->nama_rekening }}</td>
				@for($i = 1; $i <= 8; $i++)
				<?php
				$items = DB::table('penerimaan')
								->where('kode_rekening','=',$r->kode_rekening)
								->where('semester',$i)
								->where('nim_mhs',$nim)
								->get();
				$total_setoran_day = 0;
				?>
				<td align="right">
					@foreach($items as $item)
					 <?php $total_setoran_day += $item->setoran; $saldo_smt[] = array("semester" => $i,"kode_rekening" => $r->kode_rekening, "setoran" => $item->setoran);?>
					@endforeach
					@if($total_setoran_day != 0){{ rupiah($total_setoran_day) }}@endif
				</td>
				<?php $total_setoran_row += $total_setoran_day; ?>
				@endfor
				<td align="right">
				{{ rupiah($total_setoran_row) }}
				</td>
			</tr>
			<?php $total_saldo += $total_setoran_row; $no++; ?>
		@endforeach
		
			<tr>
				<td></td>
				<td>JUMLAH</td>
				@for($i = 1; $i <= 8; $i++)
					<?php
					$saldo_col = 0;
					?>
					<td align="right">
						<?php
						$setoran_col = 0;
						foreach($saldo_smt as $s){
							if($s['semester'] == $i){
								$setoran_col += $s['setoran'];
							}
						}
						?>
						@if($setoran_col != 0) <b>{{ rupiah($setoran_col) }}</b> @endif
					</td>
				@endfor
				<td align="right"><b>{{ rupiah($total_saldo) }}</b></td>
			</tr>
			
		</tbody>
	</table>
	
	@include('_ttd')
	
	